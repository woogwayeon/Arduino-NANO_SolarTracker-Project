# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'D:\2025HC_seoyeon\Ko-Jin-hyung_Python\0923_Python\solarTraker.ui'
#
# Created by: PyQt5 UI code generator 5.15.11
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

'''
PyQt5ëŠ” GUI ì´ë²¤íŠ¸ ë£¨í”„(QApplication.exec_())ê°€ ë©”ì¸ ì“°ë ˆë“œì—ì„œ ëŒê³  ìˆê¸° ë•Œë¬¸ì—, 
ê±°ê¸°ì— ì‹œë¦¬ì–¼ í†µì‹ (ë¬´í•œ ë£¨í”„)ê¹Œì§€ ë„£ìœ¼ë©´ GUIê°€ ë©ˆì¶°ë²„ë¦°ë‹¤.

ğŸ‘‰ ê·¸ë˜ì„œ ì‹œë¦¬ì–¼ í†µì‹ ì€ ë³„ë„ì˜ ì“°ë ˆë“œ(QThread) ì—ì„œ ì²˜ë¦¬í•˜ê³ , 
ë°›ì€ ë°ì´í„°ë¥¼ ì‹œê·¸ë„(signal) ë¡œ ë©”ì¸ ì“°ë ˆë“œ(PyQt5 GUI)ì— ì „ë‹¬
'''


from PyQt5 import QtCore, QtGui, QtWidgets


class Ui_MainWindow(object):
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(744, 677)
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.label_2 = QtWidgets.QLabel(self.centralwidget)
        self.label_2.setGeometry(QtCore.QRect(170, 50, 121, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_2.setFont(font)
        self.label_2.setObjectName("label_2")
        self.label_3 = QtWidgets.QLabel(self.centralwidget)
        self.label_3.setGeometry(QtCore.QRect(170, 90, 81, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_3.setFont(font)
        self.label_3.setObjectName("label_3")
        self.label_4 = QtWidgets.QLabel(self.centralwidget)
        self.label_4.setGeometry(QtCore.QRect(170, 120, 81, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_4.setFont(font)
        self.label_4.setObjectName("label_4")
        self.label_5 = QtWidgets.QLabel(self.centralwidget)
        self.label_5.setGeometry(QtCore.QRect(300, 90, 111, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_5.setFont(font)
        self.label_5.setObjectName("label_5")
        self.label_6 = QtWidgets.QLabel(self.centralwidget)
        self.label_6.setGeometry(QtCore.QRect(300, 120, 31, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_6.setFont(font)
        self.label_6.setObjectName("label_6")
        self.label_7 = QtWidgets.QLabel(self.centralwidget)
        self.label_7.setGeometry(QtCore.QRect(300, 150, 31, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_7.setFont(font)
        self.label_7.setObjectName("label_7")
        self.label_8 = QtWidgets.QLabel(self.centralwidget)
        self.label_8.setGeometry(QtCore.QRect(300, 180, 31, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_8.setFont(font)
        self.label_8.setObjectName("label_8")
        self.label_9 = QtWidgets.QLabel(self.centralwidget)
        self.label_9.setGeometry(QtCore.QRect(300, 210, 31, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_9.setFont(font)
        self.label_9.setObjectName("label_9")
        self.label_10 = QtWidgets.QLabel(self.centralwidget)
        self.label_10.setGeometry(QtCore.QRect(360, 150, 81, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_10.setFont(font)
        self.label_10.setObjectName("label_10")
        self.label_11 = QtWidgets.QLabel(self.centralwidget)
        self.label_11.setGeometry(QtCore.QRect(360, 120, 81, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_11.setFont(font)
        self.label_11.setObjectName("label_11")
        self.label_12 = QtWidgets.QLabel(self.centralwidget)
        self.label_12.setGeometry(QtCore.QRect(360, 180, 81, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_12.setFont(font)
        self.label_12.setObjectName("label_12")
        self.label_13 = QtWidgets.QLabel(self.centralwidget)
        self.label_13.setGeometry(QtCore.QRect(360, 210, 81, 31))
        font = QtGui.QFont()
        font.setFamily("ë§‘ì€ ê³ ë”•")
        font.setPointSize(14)
        self.label_13.setFont(font)
        self.label_13.setObjectName("label_13")
        self.pushButton = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton.setGeometry(QtCore.QRect(310, 250, 121, 41))
        font = QtGui.QFont()
        font.setFamily("Noto Sans KR Black")
        font.setPointSize(14)
        font.setBold(True)
        font.setWeight(75)
        self.pushButton.setFont(font)
        self.pushButton.setObjectName("pushButton")
        self.pushButton_2 = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton_2.setGeometry(QtCore.QRect(160, 250, 121, 41))
        font = QtGui.QFont()
        font.setFamily("Noto Sans KR Black")
        font.setPointSize(14)
        font.setBold(True)
        font.setWeight(75)
        self.pushButton_2.setFont(font)
        self.pushButton_2.setObjectName("pushButton_2")
        MainWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(MainWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 744, 21))
        self.menubar.setObjectName("menubar")
        MainWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(MainWindow)
        self.statusbar.setObjectName("statusbar")
        MainWindow.setStatusBar(self.statusbar)

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))
        self.label_2.setText(_translate("MainWindow", "íƒœì–‘ê´‘ ì¶”ì ê¸°"))
        self.label_3.setText(_translate("MainWindow", "ìƒì„± ì „ì••"))
        self.label_4.setText(_translate("MainWindow", "5V"))
        self.label_5.setText(_translate("MainWindow", "ì¡°ë„ì„¼ì„œ ê°’"))
        self.label_6.setText(_translate("MainWindow", "A0"))
        self.label_7.setText(_translate("MainWindow", "A1"))
        self.label_8.setText(_translate("MainWindow", "A2"))
        self.label_9.setText(_translate("MainWindow", "A3"))
        self.label_10.setText(_translate("MainWindow", "A1 value"))
        self.label_11.setText(_translate("MainWindow", "A0 value"))
        self.label_12.setText(_translate("MainWindow", "A2 value"))
        self.label_13.setText(_translate("MainWindow", "A3 value"))
        self.pushButton.setText(_translate("MainWindow", "ì •ì§€"))
        self.pushButton_2.setText(_translate("MainWindow", "ì‹œì‘"))


def parse_line(line: str):
    """
    ì•„ë‘ì´ë…¸ ì‹œë¦¬ì–¼ ë¬¸ìì—´ì„ íŒŒì‹±í•´ì„œ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜
    ì˜ˆì‹œ ì…ë ¥:
    "A0%73%A1%72%A2%78%A3%83%      X:110 Y:180      Left Down"
    """
    result = {}

    # 1) % ë‹¨ìœ„ë¡œ ìë¥´ê¸°
    parts = [p for p in line.split('%') if p.strip() != ""]

    # 2) A0, A1 ... ì„¼ì„œê°’ ì¶”ì¶œ (ì§ìˆ˜=ì´ë¦„, í™€ìˆ˜=ê°’)
    for i in range(0, len(parts) - 1, 2):
        if parts[i].startswith("A"):
            key = parts[i]
            try:
                value = int(parts[i + 1])
                result[key] = value
            except ValueError:
                continue

    # 3) ë§ˆì§€ë§‰ ë¬¸ìì—´ì—ì„œ X, Y, ìœ„ì¹˜ ì •ë³´ ì¶”ì¶œ
    last_part = parts[-1].strip()
    tokens = last_part.split()

    for token in tokens:
        if token.startswith("X:"):
            result["X"] = int(token.replace("X:", ""))
        elif token.startswith("Y:"):
            result["Y"] = int(token.replace("Y:", ""))

    # X:, Y:ê°€ ì•„ë‹Œ ë¶€ë¶„ì€ posë¡œ ì €ì¥
    others = [t for t in tokens if not t.startswith(("X:", "Y:"))]
    if others:
        result["pos"] = " ".join(others)

    return result


def serialSlice():
    # ì•„ë‘ì´ë…¸ í¬íŠ¸ ì„¤ì • (í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”)
    arduino = serial.Serial(port='COM4', baudrate=9600, timeout=1)
    time.sleep(2)  # ì•„ë‘ì´ë…¸ ìë™ ë¦¬ì…‹ ëŒ€ê¸°

    print("ì‹œë¦¬ì–¼ í†µì‹  ì‹œì‘...")

    while True:
        if arduino.in_waiting > 0:
            line = arduino.readline().decode('utf-8', errors='ignore').strip()
            if line:  # ë¹ˆ ì¤„ì´ ì•„ë‹ ê²½ìš°
                data = parse_line(line)
                print(data)


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()

    serialSlice()
    
    sys.exit(app.exec_())
